#!/bin/bash

# Shortcuts Help Panel - Vimium-style overlay for terminal shortcuts

# Colors
TITLE_COLOR='\033[1;36m'    # Bold Cyan
SECTION_COLOR='\033[1;33m'   # Bold Yellow
KEY_COLOR='\033[1;32m'       # Bold Green
DESC_COLOR='\033[0m'         # Normal
RESET='\033[0m'

# Check if we're in tmux
if [ -n "$TMUX" ]; then
    # Display in tmux popup
    tmux display-popup -E -w 80 -h 40 -T "⌨️  Shortcuts Help" bash -c "
        clear
        echo -e '${TITLE_COLOR}╔════════════════════════════════════════════════════════════════════════╗${RESET}'
        echo -e '${TITLE_COLOR}║                           SHORTCUTS REFERENCE                          ║${RESET}'
        echo -e '${TITLE_COLOR}╚════════════════════════════════════════════════════════════════════════╝${RESET}'
        echo
        echo -e '${SECTION_COLOR}━━━ TMUX (Prefix: Ctrl+a) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}'
        echo -e '  ${KEY_COLOR}Ctrl+f${DESC_COLOR}         Open tmux sessionizer'
        echo -e '  ${KEY_COLOR}Prefix |${DESC_COLOR}       Split window vertically'
        echo -e '  ${KEY_COLOR}Prefix -${DESC_COLOR}       Split window horizontally'
        echo -e '  ${KEY_COLOR}Prefix r${DESC_COLOR}       Reload tmux config'
        echo -e '  ${KEY_COLOR}Prefix h/j/k/l${DESC_COLOR} Navigate panes (vim-style)'
        echo -e '  ${KEY_COLOR}Ctrl+h/j/k/l${DESC_COLOR}   Navigate panes (works with vim)'
        echo -e '  ${KEY_COLOR}Prefix H/J/K/L${DESC_COLOR} Resize panes (5 units)'
        echo -e '  ${KEY_COLOR}Alt+←/→/↑/↓${DESC_COLOR}    Navigate panes (arrow keys)'
        echo -e '  ${KEY_COLOR}Ctrl+p/n${DESC_COLOR}       Previous/Next window'
        echo -e '  ${KEY_COLOR}Prefix c${DESC_COLOR}       Create new window'
        echo -e '  ${KEY_COLOR}Prefix ,${DESC_COLOR}       Rename window'
        echo -e '  ${KEY_COLOR}Prefix &${DESC_COLOR}       Kill window'
        echo -e '  ${KEY_COLOR}Prefix x${DESC_COLOR}       Kill pane'
        echo -e '  ${KEY_COLOR}Prefix d${DESC_COLOR}       Detach from session'
        echo
        echo -e '${SECTION_COLOR}━━━ ZSH ALIASES ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}'
        echo -e '  ${KEY_COLOR}v, vi, vim${DESC_COLOR}     Open Neovim'
        echo -e '  ${KEY_COLOR}ll${DESC_COLOR}             List files (detailed)'
        echo -e '  ${KEY_COLOR}la${DESC_COLOR}             List all files'
        echo -e '  ${KEY_COLOR}l${DESC_COLOR}              List files (compact)'
        echo -e '  ${KEY_COLOR}..${DESC_COLOR}             Go up one directory'
        echo -e '  ${KEY_COLOR}...${DESC_COLOR}            Go up two directories'
        echo -e '  ${KEY_COLOR}browser${DESC_COLOR}        Open Chromium browser'
        echo
        echo -e '${SECTION_COLOR}━━━ GIT ALIASES ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}'
        echo -e '  ${KEY_COLOR}gs${DESC_COLOR}             Git status'
        echo -e '  ${KEY_COLOR}gc${DESC_COLOR}             Git commit'
        echo -e '  ${KEY_COLOR}gp${DESC_COLOR}             Git push'
        echo -e '  ${KEY_COLOR}gpl${DESC_COLOR}            Git pull'
        echo -e '  ${KEY_COLOR}gco${DESC_COLOR}            Git checkout'
        echo -e '  ${KEY_COLOR}gb${DESC_COLOR}             Git branch'
        echo -e '  ${KEY_COLOR}ga${DESC_COLOR}             Git add'
        echo -e '  ${KEY_COLOR}gd${DESC_COLOR}             Git diff'
        echo -e '  ${KEY_COLOR}gl${DESC_COLOR}             Git log (graph)'
        echo
        echo -e '${SECTION_COLOR}━━━ TMUX SESSION ALIASES ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}'
        echo -e '  ${KEY_COLOR}ta <name>${DESC_COLOR}      Attach to tmux session'
        echo -e '  ${KEY_COLOR}tad <name>${DESC_COLOR}     Attach to session (detach others)'
        echo -e '  ${KEY_COLOR}ts <name>${DESC_COLOR}      Create new tmux session'
        echo -e '  ${KEY_COLOR}tl${DESC_COLOR}             List tmux sessions'
        echo -e '  ${KEY_COLOR}tkss <name>${DESC_COLOR}    Kill tmux session'
        echo -e '  ${KEY_COLOR}tksv${DESC_COLOR}           Kill tmux server'
        echo
        echo -e '${SECTION_COLOR}━━━ i3 WINDOW MANAGER (Mod=Super/Win) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}'
        echo -e '  ${KEY_COLOR}Mod+Return${DESC_COLOR}     Open terminal (Kitty)'
        echo -e '  ${KEY_COLOR}Mod+d${DESC_COLOR}          Application launcher (Rofi)'
        echo -e '  ${KEY_COLOR}Mod+h/j/k/l${DESC_COLOR}    Navigate windows'
        echo -e '  ${KEY_COLOR}Mod+Shift+h/j/k/l${DESC_COLOR} Move windows'
        echo -e '  ${KEY_COLOR}Mod+1-0${DESC_COLOR}        Switch workspaces'
        echo -e '  ${KEY_COLOR}Mod+Shift+q${DESC_COLOR}    Close window'
        echo -e '  ${KEY_COLOR}Mod+f${DESC_COLOR}          Toggle fullscreen'
        echo -e '  ${KEY_COLOR}Mod+e${DESC_COLOR}          Toggle split direction'
        echo -e '  ${KEY_COLOR}Mod+Shift+r${DESC_COLOR}    Restart i3'
        echo
        echo -e '${TITLE_COLOR}Press any key to close...${RESET}'
        read -n1
    "
else
    # Display using rofi if not in tmux
    if command -v rofi &> /dev/null; then
        # Create temporary file with shortcuts
        TMPFILE=$(mktemp /tmp/shortcuts.XXXXXX)
        cat > "$TMPFILE" << 'EOF'
<b>TMUX SHORTCUTS (Prefix: Ctrl+a)</b>
Ctrl+f              Open tmux sessionizer
Prefix |            Split window vertically
Prefix -            Split window horizontally
Prefix r            Reload tmux config
Prefix h/j/k/l      Navigate panes (vim-style)
Ctrl+h/j/k/l        Navigate panes (works with vim)
Prefix H/J/K/L      Resize panes (5 units)
Alt+←/→/↑/↓         Navigate panes (arrow keys)
Ctrl+p/n            Previous/Next window
Prefix c            Create new window
Prefix ,            Rename window
Prefix &            Kill window
Prefix x            Kill pane
Prefix d            Detach from session

<b>ZSH ALIASES</b>
v, vi, vim          Open Neovim
ll                  List files (detailed)
la                  List all files
l                   List files (compact)
..                  Go up one directory
...                 Go up two directories
browser             Open Chromium browser

<b>GIT ALIASES</b>
gs                  Git status
gc                  Git commit
gp                  Git push
gpl                 Git pull
gco                 Git checkout
gb                  Git branch
ga                  Git add
gd                  Git diff
gl                  Git log (graph)

<b>TMUX SESSION ALIASES</b>
ta <name>           Attach to tmux session
tad <name>          Attach to session (detach others)
ts <name>           Create new tmux session
tl                  List tmux sessions
tkss <name>         Kill tmux session
tksv                Kill tmux server

<b>i3 WINDOW MANAGER (Mod=Super/Win)</b>
Mod+Return          Open terminal (Kitty)
Mod+d               Application launcher (Rofi)
Mod+h/j/k/l         Navigate windows
Mod+Shift+h/j/k/l   Move windows
Mod+1-0             Switch workspaces
Mod+Shift+q         Close window
Mod+f               Toggle fullscreen
Mod+e               Toggle split direction
Mod+Shift+r         Restart i3
EOF
        
        rofi -dmenu -p "Shortcuts Help" -markup-rows -i -no-custom \
             -theme-str 'window {width: 60%;}' \
             -theme-str 'listview {lines: 30;}' < "$TMPFILE"
        
        rm -f "$TMPFILE"
    else
        # Fallback to less
        clear
        echo -e "${TITLE_COLOR}SHORTCUTS REFERENCE${RESET}"
        echo -e "${TITLE_COLOR}===================${RESET}"
        echo
        echo -e "${SECTION_COLOR}TMUX (Prefix: Ctrl+a)${RESET}"
        echo "  Ctrl+f         Open tmux sessionizer"
        echo "  Prefix |       Split window vertically"
        echo "  Prefix -       Split window horizontally"
        echo "  Prefix r       Reload tmux config"
        echo "  Prefix h/j/k/l Navigate panes (vim-style)"
        echo "  Ctrl+h/j/k/l   Navigate panes (works with vim)"
        echo "  Prefix H/J/K/L Resize panes (5 units)"
        echo "  Alt+←/→/↑/↓    Navigate panes (arrow keys)"
        echo "  Ctrl+p/n       Previous/Next window"
        echo
        echo -e "${SECTION_COLOR}ZSH ALIASES${RESET}"
        echo "  v, vi, vim     Open Neovim"
        echo "  ll             List files (detailed)"
        echo "  la             List all files"
        echo "  l              List files (compact)"
        echo
        echo -e "${SECTION_COLOR}GIT ALIASES${RESET}"
        echo "  gs             Git status"
        echo "  gc             Git commit"
        echo "  gp             Git push"
        echo "  gpl            Git pull"
        echo "  gco            Git checkout"
        echo "  gb             Git branch"
        echo "  ga             Git add"
        echo "  gd             Git diff"
        echo "  gl             Git log (graph)"
        echo
        echo "Press 'q' to quit"
        echo
        echo "Add 'shortcuts-help' to see this anytime"
    fi
fi